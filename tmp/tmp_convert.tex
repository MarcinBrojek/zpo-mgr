\makeatletter
\documentclass{article}
\usepackage[a4paper, total={6in, 8in}, margin=0.2in]{geometry}
\usepackage{graphicx} % Required for inserting images
\usepackage{amssymb}
\usepackage{amsbsy}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{multicol}
\usepackage{parskip}
\newcommand{\bound}[1]{\rceil {#1} \lceil}

\definecolor{battleshipgrey}{rgb}{0.52, 0.52, 0.51}

\newcommand{\com}[1]{\textcolor{battleshipgrey}{\hfill\llap{\hspace*{1em}{#1}}}}

\newcommand{\tm}[1]{\textcolor{brown}{#1}}
\newcommand{\tmb}[1]{\textcolor{blue}{#1}}
\newcommand{\ntm}[1]{\colorbox{blue!30}{$#1$}}

\newcommand{\srbegin}[3]{
    \ntm{#1} $\in$ {#2} ::= {#3} % symbol + syntax category + first el of rule
    \snextel
} % syntax rule
\newcommand{\srend}{}
\newcommand{\srel}[1]{{#1} \snextel} % syntax element
\newcommand{\snextel}{\@ifnextchar{\srend}{}{$|$ \srel}}

\newcommand{\osr}[3]{
\begin{tabular}{ c }
 #2 \\
 \hline
 #3
\end{tabular}~{\tiny #1}
}

% https://tex.stackexchange.com/questions/83882/how-to-highlight-python-syntax-in-latex-listings-lstinputlistings-command
% Default fixed font does not support bold face
\DeclareFixedFont{\ttb}{T1}{txtt}{bx}{n}{8} % for bold
\DeclareFixedFont{\ttm}{T1}{txtt}{m}{n}{8}  % for normal

% Custom colors
\definecolor{deepblue}{rgb}{0,0,0.5}
\definecolor{deepred}{rgb}{0.6,0,0}
\definecolor{deepgreen}{rgb}{0,0.5,0}

% Python style for highlighting
\newcommand\pythonstyle{\lstset{
language=Python,
basicstyle=\ttm,
morekeywords={self},              % Add keywords here
keywordstyle=\ttb\color{deepblue},
emph={MyClass,__init__},          % Custom highlighting
emphstyle=\ttb\color{deepred},    % Custom highlighting style
stringstyle=\color{deepgreen},
frame=tb,                         % Any extra options here
showstringspaces=false
}}


% Python environment
\lstnewenvironment{python}[1][]
{
\pythonstyle
\lstset{#1}
}
{}

\title{Semantics}
\author{m.brojek2 }
\date{January 2024}

\begin{document}
\ntm{sp} $\in$ sp ::= \ntm{e}  $|$ \ntm{t} \\
~\\\\\ntm{e} $\in$ e ::= /0/ $|$ /s/ "(" \ntm{e}  ")" $|$ \ntm{e}  /+/ \ntm{e} \\
~\\\\\ntm{t} $\in$ t ::= /unit/\\
~\\\\\osr{te1}{}{\ntm{\Gamma_{}} $\vdash$ \tmb{[}\ntm{e_{}}\tmb{]}:\tmb{[}\tmb{[}unit\tmb{]}\tmb{]}}\\
~\\\\\osr{te2}{}{\ntm{\Gamma_{}} $\vdash$ \ntm{sp_{}}:\tmb{[}\tmb{[}unit\tmb{]}\tmb{]}}\\
~\\\\\osr{oe1}{}{\tm{$<$}\tmb{[}\tmb{[}\ntm{e_{1}}\tmb{,}+\tmb{,}\tmb{[}s\tmb{,}\ntm{e_{2}}\tmb{]}\tmb{]}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$} $\to$ \tm{$<$}\tmb{[}\tmb{[}\tmb{[}s\tmb{,}\ntm{e_{1}}\tmb{]}\tmb{,}+\tmb{,}\ntm{e_{2}}\tmb{]}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$}}\\
~\\\\\osr{oe2}{}{\tm{$<$}\tmb{[}\tmb{[}\ntm{e_{1}}\tmb{,}+\tmb{,}\tmb{[}0\tmb{]}\tmb{]}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$} $\to$ \tm{$<$}\tmb{[}\ntm{e_{1}}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$}}\\
~\\\\\osr{oe3}{\tm{$<$}\tmb{[}\ntm{e_{1}}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$} $\to$ \tm{$<$}\tmb{[}\ntm{e_{3}}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$}}{\tm{$<$}\tmb{[}\tmb{[}\ntm{e_{1}}\tmb{,}+\tmb{,}\ntm{e_{2}}\tmb{]}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$} $\to$ \tm{$<$}\tmb{[}\tmb{[}\ntm{e_{3}}\tmb{,}+\tmb{,}\ntm{e_{2}}\tmb{]}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$}}\\
~\\\\\osr{oe4}{\tm{$<$}\tmb{[}\ntm{e_{2}}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$} $\to$ \tm{$<$}\tmb{[}\ntm{e_{3}}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$}}{\tm{$<$}\tmb{[}\tmb{[}\ntm{e_{1}}\tmb{,}+\tmb{,}\ntm{e_{2}}\tmb{]}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$} $\to$ \tm{$<$}\tmb{[}\tmb{[}\ntm{e_{1}}\tmb{,}+\tmb{,}\ntm{e_{3}}\tmb{]}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$}}\\
~\\\\update\tm{(}\tmb{[}\tmb{[}\tmb{[}s\tmb{,}\ntm{e_{}}\tmb{]}\tmb{]}\tmb{,}\ntm{s_{1}}\tmb{]}\tm{$|$}\tmb{[}\tmb{[}\ntm{e_{}}\tmb{]}\tmb{,}\ntm{s_{2}}\tmb{]}\tm{)}\tm{`}\begin{python}
s_2 = s_1
if type(s_2[1]) != int:
    s_2[1] = 1
else:
    s_2[1] += 1
\end{python}\tm{`}
~\\\\\osr{transferOneToken}{update\tm{(}\tmb{[}\tmb{[}\ntm{e_{1}}\tmb{]}\tmb{,}\ntm{s_{1}}\tmb{]}\tm{$|$}\tmb{[}\tmb{[}\ntm{e_{2}}\tmb{]}\tmb{,}\ntm{s_{2}}\tmb{]}\tm{)}}{\tm{$<$}\tmb{[}\ntm{e_{1}}\tmb{]}\tm{,}\ntm{s_{1}}\tm{$>$} $\to$ \tm{$<$}\tmb{[}\ntm{e_{2}}\tmb{]}\tm{,}\ntm{s_{2}}\tm{$>$}}\\
~\\\\\osr{end}{}{\tm{$<$}\tmb{[}\tmb{[}0\tmb{]}\tmb{]}\tm{,}\ntm{s_{}}\tm{$>$} $\to$ \ntm{s_{}}}\\
~\\\\\tmb{[}\tmb{[}\tmb{[}\tmb{[}\tmb{[}s\tmb{,}\tmb{[}s\tmb{,}\tmb{[}0\tmb{]}\tmb{]}\tmb{]}\tmb{,}+\tmb{,}\tmb{[}s\tmb{,}\tmb{[}0\tmb{]}\tmb{]}\tmb{]}\tmb{,}+\tmb{,}\tmb{[}0\tmb{]}\tmb{]}\tmb{,}+\tmb{,}\tmb{[}s\tmb{,}\tmb{[}0\tmb{]}\tmb{]}\tmb{]}\tmb{]}
~\\\\\tmb{[}\tmb{[}\tmb{[}0\tmb{]}\tmb{,}+\tmb{,}\tmb{[}s\tmb{,}\tmb{[}s\tmb{,}\tmb{[}s\tmb{,}\tmb{[}0\tmb{]}\tmb{]}\tmb{]}\tmb{]}\tmb{]}\tmb{]}

\end{document}
